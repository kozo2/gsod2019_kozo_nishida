---
title: "Loading Networks"
author: "Kozo Nishida, Kristina Hanspers and Alex Pico"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc: true
    toc_depth: 4
    df_print: paged
---
```{r, echo = FALSE}
knitr::opts_chunk$set(
  eval=FALSE
)
```

*The R markdown is available from the pulldown menu for* Code *at the upper-right, choose "Download Rmd", or [download the Rmd from GitHub](https://raw.githubusercontent.com/nrnb/gsod2019_kozo_nishida/master/loading-networks.Rmd).*

<hr />

In Cytoscape, network data can be loaded from a variety of sources, and in several different formats. Where you get your network data depends on your biological question and analysis plan. This tutorial outlines how to load network data from several popular sources and formats.

1. Public databases
  - **NDEx**
  - **PSICQUIC**
  - **STRING/STITCH**
  - **WikiPathways**
2. Local and remote files
3. Cytoscape apps (Biopax, KEGG and other formats)

<hr />

# Installation
```{r, eval = FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")

if(!"RCy3" %in% installed.packages())
  BiocManager::install("RCy3")

library(RCy3)
```

# Getting started
First, launch Cytoscape and keep it running whenever using RCy3. Confirm that you have everything installed and running:
```{r}
    cytoscapePing()
    cytoscapeVersionInfo()
```

# Prerequisites

The exercises require you to have certain Cytoscape apps and R packages installed.

```{r}
installApp('stringApp')
installApp('WikiPathways')

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("ndexr")
BiocManager::install("rWikiPathways")
```

# Networks from Public Data

Cytoscape includes a Network Search tool for easy import of public network data.
In addition to core apps that are included with your Cytoscape installation (NDEx and PSICQUIC), the resources listed here will depend on which apps you have installed.

```{r}
getInstalledApps()
```

# NDEx

The [NDEx Project](http://www.ndexbio.org/) provides an open-source framework where scientists and organizations can share, store, manipulate, and publish biological network knowledge.

- To search NDEx run the following code chunk. Here, we use "TP53 AND BARD1" as our search terms.

```{r}
library(ndexr)
ndexcon <- ndex_connect()
networks <- ndex_find_networks(ndexcon, "TP53 AND BARD1")
print(networks[,c("name","externalId","nodeCount","edgeCount")])
```

- We can work with this list. Letâ€™s use the first hit. **Note: you are going to get different hits as this database changes over time, so proceed with any hit you like.**

```{r}
networkId = networks$externalId[1]
network = ndex_get_network(ndexcon, networkId)
print(network)
```

- To import the network into Cytoscape, run the following code chunk.

```{r}
importNetworkFromNDEx(networkId)
```

# STRING/STITCH

STRING is a database of known and predicted protein-protein interactions, and STITCH stored known and predicted interactions between chemicals and proteins. Data types include:

- Genomic Context Predictions
- High-throughput Lab Experiments
- (Conserved) Co-Expression
- Automated Textmining
- Previous Knowledge in Databases

To search STRING with the disease keyword "ovarian cancer", run the following code chunk.
(The resulting network will load automatically.)

```{r}
string.cmd = 'string disease query disease="ovarian cancer"'
commandsRun(string.cmd)
```

- Networks load with a STRING-specific style, which includes 3D protein structure diagrams.

```{r}
exportImage('ovarian_cancer', 'PNG')
```

- STRING networks also inlcude data as node/interaction attributes, that can be used to create a **Style**.

```{r}
df <- getTableColumns()
View(df)
```

- The STRING app includes options to change interaction confidence level, expand the network etc.

```{r}
getEdgeCount() #Before changing interaction confidence level
```

```{r}
string.cmd = 'string change confidence confidence=0.9 network=CURRENT'
commandsRun(string.cmd)
```

```{r}
getEdgeCount() #After changing interaction confidence level
```

```{r}
exportImage('before_expand', 'PNG')
```

```{r}
string.cmd = 'string expand network=CURRENT'
commandsRun(string.cmd)
```

```{r}
exportImage('after_expand', 'PNG')
```

# WikiPathways

[WikiPathways](https://www.wikipathways.org/) is a collaborative wiki platform with manually pathway models. 
It currently covers over 2,600 pathways in 25 species-specific collections.

- To search WikiPathways, load [rWikiPathways](https://bioconductor.org/packages/release/bioc/html/rWikiPathways.html) and call the `findPathwayByText` function with your search terms (here we use 'statin' as the term)

```{r}
library(rWikiPathways)
statin.pathways <- findPathwaysByText('statin')
```
