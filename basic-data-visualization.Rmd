---
title: "Basic Data Visualization"
author: "Kozo Nishida, Kristina Hanspers and Alex Pico"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc: true
    toc_depth: 3
    df_print: paged
---
```{r, echo = FALSE}
knitr::opts_chunk$set(
  eval=FALSE
)
```

# Installation
```{r, eval = FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")

if(!"RCy3" %in% installed.packages())
  BiocManager::install("RCy3")

library(RCy3)
```

## Prerequisites
In addition to the RCy3 package, you will need the latest version of Cytoscape, which can be downloaded from http://www.cytoscape.org/download.php. Simply follow the installation instructions on screen.

## Getting started
First, launch Cytoscape and keep it running whenever using RCy3. Confirm that you have everything installed and running:
```{r}
    cytoscapePing()
    cytoscapeVersionInfo()
```

# Basic Data Visualization

**Cytoscape is an open source software platform for integrating, visualizing, and analyzing measurement data in the context of networks.**

This tutorial presents a scenario of how expression and network data can be combined to tell a biological story and includes these concepts:

 - Visualizing networks using expression data.
 - Filtering networks based on expression data.
 - Assessing expression data in the context of a biological network.

## Loading Network
You can download the [demo network session file](https://nrnb.org/data/BasicDataVizDemo.cys) to your current working directory by running...

```{r}
download.file("https://nrnb.org/data/BasicDataVizDemo.cys", "./BasicDataVizDemo.cys", 'curl')
```

Now open the demo network using...

```{r}
openSession(file.location = "./BasicDataVizDemo.cys")
```

Now you should see a network like this.

```{r}
exportImage("./images/basic-data-vizualization/BasicDataVizDemo.png")
```

![](./images/basic-data-vizualization/BasicDataVizDemo.png)

## Visualizing Expression Data on Networks

Probably the most common use of expression data in Cytoscape is to set the **visual properties** of the nodes (color, shape, border) in a network according to expression data. This creates a powerful visualization, portraying functional relation and experimental response at the same time. Here, we will show an example of doing this.

The data used in this example is from yeast, and represents an experiment of perturbations of the genes **Gal1**, **Gal4**, and **Gal80**, which are all yeast transcription factors.

For this tutorial, the experimental data was part of the Cytoscape session file you loaded earlier, and is visible in the Node Table:

![](https://cytoscape.org/cytoscape-tutorials/protocols/basic-data-visualization/Galbrowse3.png)

- You can select nodes in the network by 

```{r}
selectNodes(c("YDL194W", "YLR345W"), by.col = "name")
```

- Selecting one or more nodes in the network will update the Node Table to show only the corresponding row(s).

![](./images/basic-data-vizualization/SelectNodes.PNG)

We can now use the data to manipulate the visual properties of the network by mapping specific data columns to visual style properties:

- The **gal80Rexp** expression values will be mapped to node color; nodes with low expression will be colored blue, nodes with high expression will be colored red.
- Significance for expression values will be mapped to Node Border Width, so nodes with significant changes will appear with a thicker border.

### Set Node Fill Color

- Click on the **Style** tab in the Control Panel. And you can set node fill color by

```{r}
gal80Rexp.score.table <- getTableColumns('node','gal80Rexp')
gal80Rexp.min <- min(gal80Rexp.score.table, na.rm = T)
gal80Rexp.max <- max(gal80Rexp.score.table, na.rm = T)
gal80Rexp.center <- gal80Rexp.min + (gal80Rexp.max - gal80Rexp.min)/2
setNodeColorMapping('gal80Rexp', c(gal80Rexp.min, gal80Rexp.center, gal80Rexp.max), c('#0000FF', '#FFFFFF', '#FF0000'))
```

- This produces an initial gradient ranging from blue to red for expression values. Notice that the nodes in the network change color.

![](./images/basic-data-vizualization/SetNodeFillColor.PNG)

### Set Default Node Color

Some nodes in the network don't have any data, and for those nodes, the default color applies. In our case, the default color is blue, which falls within the spectrum of our blue-red gradient. This is not ideal for data visualization, so a useful trick is to choose a color outside the gradient spectrum to distinguish nodes with no defined expression value.

- Still in the **Style** tab, And you can set default node color to dark gray by

```{r}
setNodeColorDefault('#666666')
```

![](./images/basic-data-vizualization/SetDefaultNodeColor.PNG)

### Set Node Border Width

You can set the Border Width by
```{r}
gal80Rsig.score.table <- getTableColumns('node','gal80Rsig')
gal80Rsig.min <- min(gal80Rsig.score.table, na.rm = T)
gal80Rsig.max <- max(gal80Rsig.score.table, na.rm = T)

setNodeBorderWidthMapping('gal80Rsig', c(gal80Rsig.min, gal80Rsig.max), c(10,30))
```

This defines the node border width over the range of `gal80Rsig` column p-values like
![](./images/basic-data-vizualization/SetNodeBorderWidth.PNG)

### Creating a Legend

## Layouts
An important aspect of network visualization is the layout, meaning the positioning of nodes and edges. Our network had a preset layout in the original file you imported, but this can be changed.

- Let's change the layout to **Degree Sorted Circle Layout** by 

```{r}
layoutNetwork("degree-circle")
```

```{r}
exportImage("./images/basic-data-vizualization/degree-circle.png")
```

![](./images/basic-data-vizualization/degree-circle.png)

  In this layout, nodes are sorted by degree (connectedness), with the highest degree node at the 6 o'clock position, and remaining nodes are sorted counter clock-wise based on decreasing degree.

For this network, a degree-sorted circle layout may not be the most effective. Instead, let's try a force-directed layout instead, which may work better with this network.

```{r}
layoutNetwork("force-directed")
```

```{r}
exportImage("./images/basic-data-vizualization/force-directed.png")
```

![](./images/basic-data-vizualization/force-directed.png)

Cytoscape supports many different layout algorithms, described in detail in the [Cytoscape manual](http://manual.cytoscape.org/en/stable/Navigation_and_Layout.html?highlight=layout#automatic-layout-algorithms).

## Select Nodes

### Expand Selection and Create New Network

## Saving Results
